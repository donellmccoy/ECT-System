<?xml version="1.0" encoding="utf-8"?>

<!-- =====================================================================================
WEB.CONFIG TRANSFORMATION FOR TESTING ENVIRONMENT =====================================================================================

This file contains XML Document Transform (XDT) transformations that modify the base
web.config file specifically for the Testing environment. XDT allows environment-
specific configuration changes without duplicating the entire web.config file.

TRANSFORMATION SYNTAX:
- xdt:Transform: Specifies the transformation operation (Replace, SetAttributes, etc.)
- xdt:Locator: Specifies how to locate the element to transform (Match, Condition, etc.)

These transformations ensure the application runs correctly in the testing environment
with appropriate database connections, relaxed security settings, detailed error
reporting, and other testing-specific configurations.

The testing environment is used for:
- Integration testing with production-like data
- User acceptance testing (UAT)
- Performance testing
- Pre-production validation

All transformations are applied by MSBuild during the publish process when the
"Testing" configuration is selected.
-->

<!-- =================================================================================
EXAMPLE TRANSFORMATION SYNTAX =================================================================================

The example below demonstrates XDT transformation syntax. The "SetAttributes" transform
changes the value of "connectionString" to use "ReleaseSQLServer" only when the "Match"
locator finds an attribute "name" that has a value of "MyDB".

This example shows how to selectively modify specific attributes rather than replacing
entire sections. In practice, most transformations in this file use "Replace" to
completely override sections with testing-specific values.

XDT provides powerful ways to modify configuration files:
- Replace: Completely replace an element
- SetAttributes: Modify only specific attributes
- Insert: Add new elements
- Remove: Delete elements
- InsertBefore/InsertAfter: Add elements at specific positions

The transformations in this file are designed to be safe and predictable, ensuring
that testing configurations don't accidentally affect other environments.
-->

<configuration xmlns:xdt="http://schemas.microsoft.com/XML-Document-Transform">
  <!-- =================================================================================
    CONNECTION STRINGS TRANSFORMATION
    ==================================================================================

    This transformation completely replaces the connectionStrings section with testing-
    specific database connections. The testing environment uses a dedicated database
    server that contains test data and configurations separate from development and
    production environments.

    WHY THIS TRANSFORMATION IS NEEDED:
    - Testing requires isolated data that won't interfere with development work
    - Test data can be refreshed/reset without affecting other environments
    - Allows testing with production-like data volumes and complexity
    - Prevents accidental data corruption in development databases

    CONNECTION DETAILS:
    - Server: uhhz-db-009v.area52.afnoapps.usaf.mil\MSSQLSERVER2014
      This is a dedicated SQL Server 2014 instance in the testing environment
      located in the AFNET testing network segment.

    - Database: ALOD (primary) and SRXLite (secondary)
      ALOD contains the main Line of Duty investigation data
      SRXLite contains SRX document exchange and related functionality

    - Authentication: SQL Server Authentication with dedicated service account
      User ID: ALOD_ASPNET_SESSION
      This account has appropriate permissions for the testing databases

    SECURITY CONSIDERATIONS:
    - Password is stored in configuration (consider encryption for production)
    - Service account has limited permissions appropriate for application needs
    - Network isolation prevents unauthorized access from other environments

    The commented-out alternative connections show previous configurations that
    may be used for different testing scenarios or network configurations.
  -->
  <connectionStrings xdt:Transform="Replace">
    <remove name="LocalSqlServer" />
    <add name="LOD" connectionString="Data Source=uhhz-db-009v.area52.afnoapps.usaf.mil\MSSQLSERVER2014;Initial Catalog=ALOD;User ID=ALOD_ASPNET_SESSION; Password=alodpwd!2009;" providerName="System.Data.SqlClient" />
    <add name="SRXLite" connectionString="Data Source=uhhz-db-009v.area52.afnoapps.usaf.mil\MSSQLSERVER2014;Initial Catalog=SRXLite;User ID=ALOD_ASPNET_SESSION; Password=alodpwd!2009;" providerName="System.Data.SqlClient" />

    <!-- <add name="LOD" connectionString="Data Source=129.54.18.104;Initial Catalog=ALOD;UID=ALOD_ASPNET_SESSION;Password=alodpwd!2009;" providerName="System.Data.SqlClient" /> -->
    <!-- <add name="SRXLite" connectionString="Data Source=129.54.18.104;Asynchronous Processing=true;Initial Catalog=SRXLite;UID=ALOD_ASPNET_SESSION; PWD=alodpwd!2009;" providerName="System.Data.SqlClient" /> -->
  </connectionStrings>
  <!-- =================================================================================
    APPLICATION SETTINGS TRANSFORMATION
    ==================================================================================

    This transformation replaces the entire appSettings section with testing-specific
    configuration values. These settings control application behavior, security policies,
    external service integrations, and user experience features.

    TESTING-SPECIFIC CONFIGURATIONS:

    AUTHENTICATION & SECURITY:
    - SingleSession: "Y" - Enforces single session per user for security testing
    - CacEnabled: "N" - Disables CAC authentication (Common Access Card) for easier testing
    - DevLoginEnabled: "Y" - Enables developer login bypass for testing convenience
    - DeployMode: "DEV" - Indicates development/testing mode for conditional logic
    - AccessDeniedUrl: Points to testing access denied page

    DATABASE & PERFORMANCE:
    - QueryTimeLimit: "10" - 10-second timeout for database queries (reasonable for testing)
    - timeoutDialog/timeoutPrompt: Session timeout warnings (5min dialog, 25min total)
    - InitialFileSizeUploadLimit: "25242880" - ~25MB file upload limit for testing

    EXTERNAL SERVICE INTEGRATION:
    - DocServiceUsername/Password: Credentials for SRX Document Service testing endpoint
    - DocServiceStylesheet: Testing URL for document styling
    - UseDBSign/DbSignUrl: Digital signature service configuration for testing

    EMAIL & COMMUNICATION:
    - EmailFrom: Testing email sender address (afrc.sgp@us.af.mil)
    - EmailEnabled: "Y" - Email functionality enabled for testing
    - ReminderEmailIsEnabled: "Y" - Automated reminders enabled

    UI & DISPLAY:
    - WaterMark: "For Official Use Only" - Standard document watermark
    - hostname: Testing environment base URL
    - ChartImageHandler: Chart image storage configuration

    LOGGING & DEBUGGING:
    - GenerationTimeLogFile: Path for performance logging
    - LogsDirectory: Log file storage location
    - CreateLogFile: "true" - Enables log file creation for debugging

    These settings are optimized for the testing environment to:
    - Enable easier testing workflows (DevLoginEnabled)
    - Provide detailed logging and error information
    - Use testing-specific service endpoints
    - Allow realistic file upload sizes for UAT
    - Maintain security policies appropriate for testing
  -->
  <appSettings xdt:Transform="Replace">
    <add key="SingleSession" value="Y" />
    <add key="QueryTimeLimit" value="10" />
    <add key="CacEnabled" value="N" />
    <add key="DevLoginEnabled" value="Y" />
    <add key="DeployMode" value="DEV" />
    <add key="AccessDeniedUrl" value="~/Public/AccessDenied.aspx" />
    <add key="authCookieName" value="LODAUTH" />
    <add key="DocServiceUsername" value="AFLOD" />
    <add key="DocServicePassword" value="DDRSalod121511*(" />
    <add key="UseDBSign" value="N" />
    <add key="DbSignDatabase" value="ALOD_DB" />
    <add key="DbSignUrl" value="https://alodtest.afrc.af.mil/dbsign/server" />
    <add key="EmailFrom" value="afrc.sgp@us.af.mil" />
    <add key="EmailEnabled" value="Y" />
    <add key="DocServiceStylesheet" value="http://alodtest.afrc.af.mil/alod/public/upload.css" />
    <add key="WaterMark" value="For Official Use Only" />
    <add key="timeoutDialog" value="5" />
    <!--The timeoutDialog value holds the number of minutes before session timeout when the dialog will appear. For example if the timeoutDialog is 6 and session timeout is set at 20 the dialog will appear at 14 minutes.-->
    <add key="timeoutPrompt" value="25" />
    <add key="KeepAliveURL" value="https://alodtest.afrc.af.mil/alod/default.aspx" />
    <add key="KeepAliveURL2" value="https://alodtest.afrc.af.mil/alod/default.aspx/" />
    <add key="ChartImageHandler" value="storage=file;timeout=20;Url=~/chartImages/;" />
    <add key="hostname" value="https://alodtest.afrc.af.mil/" />
    <add key="ReminderEmailIsEnabled" value="Y" />
    <add key="InitialFileSizeUploadLimit" value="25242880" />
    <add key="GenerationTimeLogFile" value="/Alod/Logs/generation_timeLog.txt"/>
    <add key="LogsDirectory" value="/Alod/Logs"/>
    <add key="CreateLogFile" value="true"/>
  </appSettings>
  <!-- =================================================================================
    SYSTEM.NET TRANSFORMATION
    ==================================================================================

    This transformation configures network-related settings, specifically the SMTP
    (Simple Mail Transfer Protocol) configuration for email sending in the testing
    environment.

    EMAIL CONFIGURATION FOR TESTING:
    - SMTP Host: 131.9.25.144 - Dedicated SMTP server for the testing environment
    - Port: Default SMTP port (25) is used (not explicitly specified)

    WHY TESTING NEEDS DIFFERENT SMTP SETTINGS:
    - Testing emails should not go to real users or production systems
    - Allows testing of email functionality without external side effects
    - Dedicated SMTP server can be monitored and configured for testing needs
    - Prevents accidental email spam during automated testing

    EMAIL TESTING CONSIDERATIONS:
    - Emails sent during testing may be captured by test email systems
    - SMTP server configuration ensures reliable delivery for testing scenarios
    - Network isolation prevents testing emails from reaching production users
    - Allows validation of email templates, formatting, and delivery logic

    The SMTP server at 131.9.25.144 is configured to handle testing email traffic
    and may include features like email capture, logging, or redirection for
    testing purposes.
  -->
  <system.net xdt:Transform="Replace">
    <mailSettings>
      <smtp>
        <network host="131.9.25.144" />
      </smtp>
    </mailSettings>
  </system.net>
  <!-- =================================================================================
    SESSION STATE TRANSFORMATION
    ==================================================================================

    This transformation configures ASP.NET session state storage for the testing
    environment, switching from the default in-process storage to SQL Server-based
    session storage.

    SESSION STATE CONFIGURATION:
    - allowCustomSqlDatabase: "true" - Allows custom database schema for sessions
    - cookieless: "UseCookies" - Uses cookies to maintain session state
    - mode: "SQLServer" - Stores session data in SQL Server database
    - sqlConnectionString: Points to the testing ALOD database for session storage
    - timeout: "31" - Session timeout of 31 minutes

    WHY SQL SERVER SESSION STATE FOR TESTING:
    - Allows session persistence across application restarts during testing
    - Enables testing of session-related functionality with realistic data
    - Supports load balancing testing (multiple servers sharing sessions)
    - Prevents session loss during deployments and server maintenance
    - Allows inspection of session data for debugging purposes

    TESTING BENEFITS:
    - Sessions survive application pool recycles
    - Multiple testers can work simultaneously without conflicts
    - Session data can be queried directly from database for validation
    - Supports longer testing sessions without data loss

    The session state database tables are automatically created by ASP.NET when
    the application first runs with this configuration. The tables follow the
    standard ASP.NET session state schema.
  -->
  <sessionState allowCustomSqlDatabase="true" cookieless="UseCookies" mode="SQLServer" sqlConnectionString="Data Source=uhhz-db-009v.area52.afnoapps.usaf.mil\MSSQLSERVER2014;Initial Catalog=ALOD;User ID=ALOD_ASPNET_SESSION; Password=alodpwd!2009;" timeout="31" xdt:Transform="Replace"/>
  <!-- =================================================================================
    STRONGLY-TYPED APPLICATION SETTINGS TRANSFORMATION
    ==================================================================================

    This transformation updates the strongly-typed application settings that are
    generated from Visual Studio Settings files. These settings provide type-safe
    access to configuration values through Properties.Settings.Default.

    SRX EXCHANGE DOCUMENT SERVICE ENDPOINT:
    - ALOD_Data_SRExchange_DocumentService: "https://alodtest.afrc.af.mil/srxlite/services/documentservice.asmx"

    This setting specifies the SOAP web service endpoint for the SRX (Service Request
    Exchange) Document Service, which handles document storage, retrieval, and
    management operations.

    WHY TESTING NEEDS DIFFERENT ENDPOINT:
    - Testing environment uses separate SRX service instance
    - Prevents interference with production document operations
    - Allows testing with controlled document sets
    - Enables validation of document service integration without production impact

    DOCUMENT SERVICE FUNCTIONALITY:
    - Document upload and download operations
    - File storage and retrieval with metadata
    - Document versioning and history tracking
    - Integration with external document management systems

    The testing endpoint (alodtest.afrc.af.mil) is specifically configured for
    testing scenarios and may include additional logging, test data, or mock
    responses to support comprehensive testing of document-related features.

    This setting is critical for the application's document management capabilities
    and must point to a valid, accessible SRX service endpoint.
  -->
  <applicationSettings xdt:Transform="Replace">
    <ALOD.Data.Properties.Settings>
      <setting name="ALOD_Data_SRExchange_DocumentService" serializeAs="String">
        <value>https://alodtest.afrc.af.mil/srxlite/services/documentservice.asmx</value>
      </setting>
    </ALOD.Data.Properties.Settings>
  </applicationSettings>

  <!-- =================================================================================
    SYSTEM.WEB TRANSFORMATIONS
    ==================================================================================

    These transformations modify ASP.NET runtime settings to optimize the application
    for testing scenarios. The changes enable detailed error reporting, debugging
    information, and performance monitoring that are essential for effective testing.

    CUSTOM ERRORS CONFIGURATION:
    - customErrors mode="Off": Disables custom error pages to show detailed ASP.NET
      error information instead of user-friendly error pages.

      WHY FOR TESTING:
      - Allows developers and testers to see actual error details
      - Essential for debugging application issues during testing
      - Prevents masking of underlying problems with generic error pages
      - Enables quick identification of configuration or code issues

    COMPILATION SETTINGS:
    - compilation debug="true": Enables debug compilation mode.

      WHY FOR TESTING:
      - Includes debug symbols for better error information
      - Disables certain optimizations that might hide issues
      - Allows detailed stack traces and debugging information
      - Essential for troubleshooting during testing phases

    TRACE SETTINGS:
    - trace enabled="true": Enables ASP.NET request tracing.

      WHY FOR TESTING:
      - Provides detailed information about each HTTP request
      - Shows execution time, query parameters, and server variables
      - Accessible via trace.axd for performance analysis
      - Helps identify slow requests and potential bottlenecks
      - Enables monitoring of application behavior during testing

    TESTING ENVIRONMENT BENEFITS:
    - Rapid problem identification and resolution
    - Detailed diagnostics for performance issues
    - Better debugging experience for developers
    - Comprehensive error reporting for quality assurance

    These settings would typically be reversed in production for security and
    performance reasons, but are essential for thorough testing and validation.
  -->

  <!-- =================================================================================
    SYSTEM.WEBSERVER TRANSFORMATIONS
    ==================================================================================

    These transformations modify IIS (Internet Information Services) settings to
    support testing requirements. IIS handles the web server functionality for
    ASP.NET applications.

    STATIC CONTENT CONFIGURATION:
    - staticContent: Configures how IIS serves static files (images, CSS, JavaScript).
    - clientCache cacheControlMode="DisableCache": Disables client-side caching
      of static files.

      WHY FOR TESTING:
      - Ensures static resources are always fresh during testing
      - Prevents cached versions from interfering with UI changes
      - Allows immediate validation of CSS/JavaScript modifications
      - Supports rapid iteration during development and testing
      - Eliminates cache-related issues that could mask problems

    TESTING ENVIRONMENT BENEFITS:
    - Immediate visibility of static resource changes
    - Reliable testing of UI modifications and updates
    - Prevention of cache-related bugs during testing
    - Faster development cycles with instant feedback

    These IIS settings ensure that the web server properly supports the testing
    environment's requirements for static content delivery and application functionality.
  -->
</configuration>
